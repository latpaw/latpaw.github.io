<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>Diary 2015-7 - L</title>
  <meta charset="utf-8" />
  <meta name="author" content="latpaw" />
  <meta name="description" content="&lt;TODO: insert your description here&gt;" />
  <meta name="keywords" content="&lt;TODO: insert your keywords here&gt;" />

  <link rel="alternate" title="RSS Feed" href="/rss.xml" type="application/rss+xml">
  <link rel="stylesheet" href="/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="/media/css/posts.css" type="text/css">
</head>

  <body class="container">
<header id="header">
<body>
    <nav class="navbar navbar-default navbar-fixed-top" style="opacity: .9" role="navigation">
        <div class="container-fluid">
<div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">L</a>
        </div>
<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li class="active"><a href="/blog/">Blog</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="https://github.com/latpaw">GitHub</a></li>
        </ul>
</div>
</div>
    </nav>
</body>
</header>

<section id="content" role="main">
    <div id="outline-container-sec-" class="row">
        <div class="col-md-2"></div>
            <h1>Diary 2015-7</h1>
            <div id="outline-container-org9577438" class="outline-2">
<h2 id="org9577438">2015-07- 2 02:26 Thu PM</h2>
<div class="outline-text-2" id="text-org9577438">
</div><div id="outline-container-orgd505485" class="outline-3">
<h3 id="orgd505485">几个无线概念</h3>
<div class="outline-text-3" id="text-orgd505485">
<p>
QoS 服务质量, quality of service, 用来解决无线路由延迟的机制.
</p>

<p>
SSID service set identifier, 其实就是无线名称. 可以关掉广播, 让设备无法被搜索到.
</p>

<p>
Multi-SSID, 在一个热点上开启之后相当于多个路由器,提供多个无线接入,可以隔离,可以互通.
</p>

<p>
WEP 无线加密协议 wireless encryption protocol. 已过时. xxx
</p>

<p>
WPA wifi protected access
</p>

<p>
WDS 无线分散系统, wireless dirstribution system, 把无线串接起来,有 桥接和中继 两种.
</p>

<p>
WMM 无线多媒体.
</p>

<p>
WPA-PSK 预共享密钥,( pre shared key)就是普通的设置 wifi 连接的方式, 成为 wpa 个人版, 企业版的需要 802.1X 认证中心.
</p>

<p>
Diceware 投掷色子生成密码
</p>
</div>
</div>

<div id="outline-container-orgd6ea662" class="outline-3">
<h3 id="orgd6ea662">man 使用 less 的快捷键,不装 less,  man就挂了</h3>
</div>
</div>
<div id="outline-container-org5a66e10" class="outline-2">
<h2 id="org5a66e10">2015-07- 3 02:33 Fri PM</h2>
<div class="outline-text-2" id="text-org5a66e10">
</div><div id="outline-container-orgae69e92" class="outline-3">
<h3 id="orgae69e92">修改 ssh 登陆的提示信息</h3>
<div class="outline-text-3" id="text-orgae69e92">
<p>
/ etc/issue
</p>

<p>
/etc/motd
</p>

<p>
也可以禁用掉 motd, 然后在 /etc/profile 里面添加自定义的提示,或者函数
</p>

<p>
可以自定义 command_not_found_handle 来定义没有此函数的时候的提醒.
</p>
</div>
</div>

<div id="outline-container-org56156ff" class="outline-3">
<h3 id="org56156ff">xsl</h3>
<div class="outline-text-3" id="text-org56156ff">
<p>
xsl = extensible stylesheet language, 相当于 css for xml
</p>
</div>
</div>

<div id="outline-container-org1d300d8" class="outline-3">
<h3 id="org1d300d8">zabbix agent</h3>
</div>
</div>
<div id="outline-container-org8d68ef9" class="outline-2">
<h2 id="org8d68ef9">Mon Jul  6 16:03:06 2015</h2>
<div class="outline-text-2" id="text-org8d68ef9">
</div><div id="outline-container-org3a7b7b4" class="outline-3">
<h3 id="org3a7b7b4">emacs socks5 proxy</h3>
<div class="outline-text-3" id="text-org3a7b7b4">
<div class="org-src-container">
<pre class="src src-elisp">(setq url-proxy-services
      '(("socks5" . "192.168.80.96:1080")))
</pre>
</div>
</div>
</div>
<div id="outline-container-org349beb9" class="outline-3">
<h3 id="org349beb9">linux uid</h3>
<div class="outline-text-3" id="text-org349beb9">
<p>
linux 下有 real uid 和 effective uid 两种, 正常情况下 real uid 是不会变的,当一个用户来运行当前的程序时,会临时把 effective uid 改为当前用户的 uid, 然后 kernel 来判定是否可以自执行
</p>

<p>
如果程序被加了 s 位,那么执行的时候将以创建这个程序的用户的 uid 为 effective uid, 比如说 su, sudo,  但是 uid 是轻易不会变的
</p>

<p>
程序可以通过 getuid, setuid, geteuid, seteuid 来获取和改变 uid
</p>
</div>
</div>

<div id="outline-container-org3609d51" class="outline-3">
<h3 id="org3609d51">telnet 发送邮件</h3>
<div class="outline-text-3" id="text-org3609d51">
<p>
telnet xx.xx.xx 25
</p>

<p>
EHLO mail.xxx.com
</p>

<p>
MAIL FROM: xx@xx.com
</p>

<p>
RCPT TO: xx@xx.com
</p>

<p>
DATA
</p>

<p>
Subject: hello there // you need a blank line down there
</p>

<p>
QUIT
</p>

<p>
// 安全性在哪里...
</p>
</div>
</div>

<div id="outline-container-org4fd804a" class="outline-3">
<h3 id="org4fd804a">/dev</h3>
<div class="outline-text-3" id="text-org4fd804a">
<p>
null 无底洞的空
</p>

<p>
zero 读取的全是0
</p>

<p>
full 输入任何数据提示硬盘已满,用来测试硬盘满的时候的程序表现.
</p>

<p>
random 读取随机数
</p>

<p>
urandom 持续产生随机数
</p>

<p>
loop loopback 设备,用来将文件模拟为设备. mount xxx /mnt -o loop=/dev/loop0
</p>

<p>
/dev/shm 虚拟的内存设备, 可以通过 fstab 设定其大小, 可以把 /tmp mount 到这里,提高速度
</p>
</div>
</div>
</div>

<div id="outline-container-orgd85cff5" class="outline-2">
<h2 id="orgd85cff5">Tue Jul  7 11:21:04 2015</h2>
<div class="outline-text-2" id="text-orgd85cff5">
</div><div id="outline-container-orgba7779f" class="outline-3">
<h3 id="orgba7779f">PAM</h3>
<div class="outline-text-3" id="text-orgba7779f">
<p>
pluggable authentication Modules
</p>
</div>
</div>
<div id="outline-container-org1488aec" class="outline-3">
<h3 id="org1488aec">为了防止恶意攻击,把/tmp 里边的文件,指向 passwd 等重要文件,应该创建随机名字的缓存文件.</h3>
</div>
</div>

<div id="outline-container-orgfbef912" class="outline-2">
<h2 id="orgfbef912">Wed Jul  8 10:07:45 2015</h2>
<div class="outline-text-2" id="text-orgfbef912">
</div><div id="outline-container-org1557806" class="outline-3">
<h3 id="org1557806">ranger</h3>
<div class="outline-text-3" id="text-org1557806">
<p>
可以分割终端,类似 mac 的 finder
</p>
</div>
</div>
<div id="outline-container-org9d9f732" class="outline-3">
<h3 id="org9d9f732">apt-get install most</h3>
<div class="outline-text-3" id="text-org9d9f732">
<p>
export PAGER=most
</p>

<p>
export MANWIDTH=100
</p>

<p>
可以修改 man 的样式
</p>
</div>
</div>

<div id="outline-container-orgd674f27" class="outline-3">
<h3 id="orgd674f27">nagle 算法, 避免网络中太多的小包造成拥塞</h3>
<div class="outline-text-3" id="text-orgd674f27">
<p>
基于停.等协议, 把小于一定长度的数据包,暂时放在缓存里,等数据包的长度大于等于指定长度的时候,发送.
</p>

<p>
（1）如果包长度达到MSS，则允许发送；
</p>

<p>
（2）如果该包含有FIN，则允许发送；
</p>

<p>
（3）设置了TCP_NODELAY选项，则允许发送；
</p>

<p>
（4）未设置TCP_CORK选项时，若所有发出去的小数据包（包长度小于MSS）均被确认，则允许发送；
</p>

<p>
（5）上述条件都未满足，但发生了超时（一般为200ms），则立即发送。
</p>
</div>
</div>

<div id="outline-container-orgfce7044" class="outline-3">
<h3 id="orgfce7044">cork  算法,提高网络利用效率</h3>
<div class="outline-text-3" id="text-orgfce7044">
<p>
在 nagle 的基础上,即使网络延迟非常低, 瞬间有返回 ack, 发送端也会尽量的将小包合并,着眼点不一样.
</p>
</div>
</div>

<div id="outline-container-org509c7e4" class="outline-3">
<h3 id="org509c7e4">TCP确认延迟机制</h3>
<div class="outline-text-3" id="text-org509c7e4">
<p>
当Server端收到数据之后，它并不会马上向client端发送ACK，而是会将ACK的发送延迟一段时间（假设为t），它希望在t时间内server端会向client
端发送应答数据，这样ACK就能够和应答数据一起发送，就像是应答数据捎带着ACK过去。t大概就是40ms。
</p>

<p>
这就解释了为什么'\r\n'（B块）总是在A块之后40ms才发出。
</p>
</div>
</div>

<div id="outline-container-org6ff7291" class="outline-3">
<h3 id="org6ff7291">滑动窗口</h3>
<div class="outline-text-3" id="text-org6ff7291">
<p>
滑动窗口协议是用来改善吞吐量的一种技术，即容许发送方在接收任何应答之前传送附加的包。接收方告诉发送方在某一时刻能送多少包（称窗口尺寸）。
</p>

<p>
滑动窗口协议的基本原理就是在任意时刻，发送方都维持了一个连续的允许发送的帧的序号，称为发送窗口；同时，接收方也维持了一个连续的允许接收的帧的序号，称为接收窗口。
</p>

<p>
发送窗口和接收窗口的序号的上下界不一定要一样，甚至大小也可以不同。不同的滑动窗口协议窗口大小一般不同。
</p>

<p>
发送方窗口内的序列号代表了那些已经被发送，但是还没有被确认的帧，或者是那些可以被发送的帧。
</p>
</div>
</div>
</div>

<div id="outline-container-orgdf154c1" class="outline-2">
<h2 id="orgdf154c1">Thu Jul  9 15:02:05 2015</h2>
<div class="outline-text-2" id="text-orgdf154c1">
</div><div id="outline-container-org129cf22" class="outline-3">
<h3 id="org129cf22">vim</h3>
<div class="outline-text-3" id="text-org129cf22">
<p>
缩写 :ab
</p>

<p>
:w !sudo tee % 以 root 的权限保存(当打开忘记 sudo 的时候)
</p>

<p>
di( 删除对应串内部的字符, 删除括号内的字符
</p>

<p>
daw delete a word
</p>

<p>
dt; delete to ;
</p>

<p>
df; delete to ; and ;
</p>
</div>
</div>
</div>

<div id="outline-container-orgf376157" class="outline-2">
<h2 id="orgf376157">Fri Jul 10 09:49:09 2015</h2>
<div class="outline-text-2" id="text-orgf376157">
</div><div id="outline-container-org688bf1c" class="outline-3">
<h3 id="org688bf1c">查看当前并发连接数</h3>
<div class="outline-text-3" id="text-org688bf1c">
<p>
netstat -n | awk '<i>^tcp</i> {++S[$NF]} END {for(a in S) print a, S[a]}'
</p>
</div>
</div>
</div>
<div id="outline-container-org1e6da9c" class="outline-2">
<h2 id="org1e6da9c">Tue Jul 14 10:22:51 2015</h2>
<div class="outline-text-2" id="text-org1e6da9c">
</div><div id="outline-container-org10ae26b" class="outline-3">
<h3 id="org10ae26b">chattr</h3>
<div class="outline-text-3" id="text-org10ae26b">
<p>
The letters `acdeijstuACDST' select the new attributes for the files: append only (a), compressed (c), no dump (d), extent format (e), immutable  (i),
       data  journalling  (j),  secure  deletion (s), no tail-merging (t), undeletable (u), no atime updates (A), no copy on write (C), synchronous directory
       updates (D), synchronous updates (S), and top of directory hierarchy (T).
</p>
</div>
</div>
<div id="outline-container-orgc6a84bd" class="outline-3">
<h3 id="orgc6a84bd">inotify</h3>
<div class="outline-text-3" id="text-orgc6a84bd">
<p>
inotifywait
</p>

<p>
go, ruby, python, c++ etc inotify
</p>
</div>
</div>
<div id="outline-container-org449003c" class="outline-3">
<h3 id="org449003c">lsof</h3>
<div class="outline-text-3" id="text-org449003c">
<p>
可以替代 netstat ps 命令.
</p>
</div>
</div>
<div id="outline-container-org89eeb6e" class="outline-3">
<h3 id="org89eeb6e">windows 无法添加打印机,可能是域不对,或者工作组,一般用 workgroup 就可以了.</h3>
</div>
<div id="outline-container-org045a355" class="outline-3">
<h3 id="org045a355">Mac 系统添加 windows 打印机,出现 "保持以备鉴定",只是密码不对,可以给 windows 设置密码,开启 guest 账号,或者直接输入 windows 的密码</h3>
<div class="outline-text-3" id="text-org045a355">
<p>
<a href="http://www.macx.cn/thread-2115958-1-1.html">http://www.macx.cn/thread-2115958-1-1.html</a>
</p>
</div>
</div>

<div id="outline-container-orgbc41d70" class="outline-3">
<h3 id="orgbc41d70">haproxy acl hdr_end hdr_beg hdr_dom...</h3>
<div class="outline-text-3" id="text-orgbc41d70">
<p>
haproxy  检查配置文件
</p>

<p>
haproxy -f /etc/haproxy/xx.cfg -c //只检查
</p>
</div>
</div>
</div>

<div id="outline-container-org4b0091c" class="outline-2">
<h2 id="org4b0091c">Wed Jul 15 11:02:06 2015</h2>
<div class="outline-text-2" id="text-org4b0091c">
</div><div id="outline-container-org02a40bb" class="outline-3">
<h3 id="org02a40bb">在 linux 里, 命令中的单独的 -- 可以用来分离 option 和 parameter</h3>
<div class="outline-text-3" id="text-org02a40bb">
<p>
在 -- 之后的所有的东西都不会被解析为 parameter
</p>
</div>
</div>

<div id="outline-container-org898ff5c" class="outline-3">
<h3 id="org898ff5c">.profile .bashrc</h3>
<div class="outline-text-3" id="text-org898ff5c">
<p>
.profile 文件在 bash 登录的时候加载, 也可以使用 bash -l, 其中有引入.bashrc
</p>

<p>
.bashrc 默认情况下是运行 bash 命令的时候加载, 此时不加载 .profile, 可以使用 --norc, 不加载 bashrc
</p>

<p>
修改 CDPATH 变量,可以改变 cd 的时候的默认搜索路径
</p>
</div>
</div>

<div id="outline-container-org599a6ee" class="outline-3">
<h3 id="org599a6ee">man bash , man proc , man ...</h3>
</div>
</div>

<div id="outline-container-org85b3f4a" class="outline-2">
<h2 id="org85b3f4a">Thu Jul 16 10:52:05 2015</h2>
<div class="outline-text-2" id="text-org85b3f4a">
</div><div id="outline-container-orgde77e77" class="outline-3">
<h3 id="orgde77e77">/sbin 目录下的连接</h3>
<div class="outline-text-3" id="text-orgde77e77">
<p>
shutdown , 关机
</p>

<p>
halt, 立即关掉, 正常情况下是调用 shutdown
</p>

<p>
reboot,poweroff 是 halt 的软连接
</p>

<p>
mkfs.ext2 mkfs.ext4 modprobe iptables ip fsk.ext2 swapoff 等都是链接,详见 ls -l /sbin
</p>
</div>
</div>

<div id="outline-container-org8879de0" class="outline-3">
<h3 id="org8879de0">chroot sftp,且只能通过 sftp 登录</h3>
<div class="outline-text-3" id="text-org8879de0">
<pre class="example">
Match User username // 可以是 User, 可以是 Group
  ChrootDirectory %h
  ForceCommand internal-sftp
  AllowTcpForwarding no
  PermitTunnel no
  X11Forwarding no
</pre>
<p>
sudo chown root.root /home/username //需要 chroot 的目录一定要设置为 root
</p>

<p>
记得重启 ssh 服务.
</p>
</div>
</div>
</div>

<div id="outline-container-org447fc95" class="outline-2">
<h2 id="org447fc95">Wed Jul 22 15:57:10 2015</h2>
<div class="outline-text-2" id="text-org447fc95">
</div><div id="outline-container-orgcae379c" class="outline-3">
<h3 id="orgcae379c">linux bridge</h3>
<div class="outline-text-3" id="text-orgcae379c">
<p>
apt-get install bridge-utils
</p>

<p>
brctl addbr brname
</p>

<p>
brctl addif brname eth0
</p>

<p>
ip link set dev br0 up
</p>

<p>
ip a add 192.168.0.x/22 dev br0
</p>

<p>
一定注意要写成脚本执行,否则中间会断掉网,后果很严重.
</p>
</div>
</div>
</div>
<div id="outline-container-org3929711" class="outline-2">
<h2 id="org3929711">Thu Jul 23 15:36:02 2015</h2>
<div class="outline-text-2" id="text-org3929711">
</div><div id="outline-container-org2bb4a38" class="outline-3">
<h3 id="org2bb4a38">netcat nc , 可以用来拷贝文件, 向指定端口发送数据等</h3>
<div class="outline-text-3" id="text-org2bb4a38">
<p>
nc -lp 1234 &gt; hello  // 监听端口
</p>

<p>
nc x.x.x.x 1234 &lt; txt_to_be_sent
</p>

<p>
或者: (发送压缩包)
</p>

<p>
nc -lp 1234 | tar zxvf -
</p>

<p>
tar zcvf - hello/* | nc x.x.x.x 1234
</p>

<p>
扫描端口:
</p>

<p>
nc -v -w 1 x.x.x.x -z 1-10000
</p>

<p>
telnet 功能:
</p>

<p>
nc x.x.x.x 80
</p>

<p>
nc x.x.x.x 25
</p>
</div>
</div>

<div id="outline-container-org1e24a23" class="outline-3">
<h3 id="org1e24a23">tcpdump</h3>
<div class="outline-text-3" id="text-org1e24a23">
<p>
tcpdump host xx.x.x.x and port 80 -vv -nn -XXS -A
</p>

<p>
pcap-filter // tcpdump 等包过滤工具使用的规则
</p>
</div>
</div>
</div>

<div id="outline-container-org648df9f" class="outline-2">
<h2 id="org648df9f">Tue Jul 28 10:11:33 2015</h2>
<div class="outline-text-2" id="text-org648df9f">
</div><div id="outline-container-org808ede0" class="outline-3">
<h3 id="org808ede0">proxychains ,  可以给程序开启代理,在配置文件里是一个 proxy 的链条列表</h3>
<div class="outline-text-3" id="text-org808ede0">
<p>
sockslist.net
</p>
</div>
</div>
<div id="outline-container-orgaac7f6d" class="outline-3">
<h3 id="orgaac7f6d">kvm 迁移</h3>
<div class="outline-text-3" id="text-orgaac7f6d">
<p>
出现Could not access KVM kernel module: Permission denied:
</p>

<p>
修改/ etc/libvirt/qemu.conf user 和 group 为 root, 然后重启 libvirtd 服务
</p>

<p>
qemu 2.1 too new 的问题,直接去其他的平台,拷贝一个 /usr/bin/kvm 过来
</p>

<p>
biso.bin not found
</p>

<p>
安装 seabios vgabios, 然后在 kvm 和 qemu 的目录中,做 seabios 里边 bin 的连接, 具体哪个看日志决定
</p>
</div>
</div>
</div>

<div id="outline-container-org7544cb5" class="outline-2">
<h2 id="org7544cb5">Wed Jul 29 16:06:46 2015</h2>
<div class="outline-text-2" id="text-org7544cb5">
</div><div id="outline-container-orga71a0f7" class="outline-3">
<h3 id="orga71a0f7">less</h3>
<div class="outline-text-3" id="text-orga71a0f7">
<p>
可以实用 vim/macros/less.sh ,同时有 less 的模式和 vim 的高亮功能
</p>

<p>
详见 locate less.sh
</p>

<p>
less  和 more 的 md5都一样...
</p>
</div>
</div>
</div>
<div id="outline-container-org1af587b" class="outline-2">
<h2 id="org1af587b">Thu Jul 30 17:01:48 2015</h2>
<div class="outline-text-2" id="text-org1af587b">
</div><div id="outline-container-org4dbc25f" class="outline-3">
<h3 id="org4dbc25f">dnscrypt-proxy chinadns</h3>
<div class="outline-text-3" id="text-org4dbc25f">
<p>
dnscrypt-proxy  可以使用 tcp 传输 dns 解析过程, 服务器默认是 opendns, 但是会造成国内的用户访问国外的地址
</p>

<p>
chinadns 可以区分国内和国外的 ip, 给予响应的地址,又能 防止 dns 污染
</p>

<p>
这两者也可以配合使用
</p>
</div>
</div>
</div>

    </div>
</section>


<footer id="footer">
    <br />
</footer>

  </body>
</html>
